<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PORTAL ENIGMA FALLS</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        :root { 
            --gold: #c5a059; 
            --dark-blue: #162a3d; 
            --mystic-blue: #2c567a;
            --paper: #fdfaf3; /* Tom de papel antigo/claro */
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--dark-blue); margin: 0; color: #fff; }

        /* CAPA INICIAL COM CORES DA LOGO */
        #capa { 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            text-align: center; 
            background: radial-gradient(circle, var(--mystic-blue) 0%, var(--dark-blue) 100%);
            padding: 20px;
        }

        .logo-capa { 
            max-width: 380px; 
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(197, 160, 89, 0.4);
            margin-bottom: 30px;
            border: 4px solid var(--gold);
        }

        .welcome-text {
            color: var(--gold);
            font-size: 28px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 40px;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
        }

        .botoes { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }

        .btn { 
            padding: 18px 40px; 
            border: 2px solid var(--gold); 
            border-radius: 5px;
            background: transparent; 
            color: var(--gold); 
            cursor: pointer; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            transition: 0.4s; 
            font-weight: bold;
        }

        .btn:hover { background: var(--gold); color: var(--dark-blue); box-shadow: 0 0 20px rgba(197, 160, 89, 0.6); }

        /* TELAS INTERNAS */
        .tela { display: none; min-height: 100vh; background: var(--paper); color: var(--dark-blue); padding: 20px; box-sizing: border-box; }
        
        .nav-interna { 
            max-width: 1000px; 
            margin: 0 auto 30px auto; 
            border-bottom: 3px solid var(--dark-blue);
            padding: 15px 0; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }

        /* CARDS DE NOTÍCIA */
        .feed { max-width: 850px; margin: 0 auto; }
        .post { 
            background: #fff;
            border: 1px solid #ddd;
            padding: 30px; 
            margin-bottom: 40px; 
            position: relative; 
            box-shadow: 10px 10px 0px var(--gold);
        }

        .post h2 { font-size: 32px; color: var(--dark-blue); margin: 15px 0; text-transform: uppercase; border-bottom: 2px solid var(--gold); display: inline-block; }
        .post img { width: 100%; border: 1px solid #ccc; margin: 20px 0; }
        .post-meta { font-size: 13px; color: var(--mystic-blue); font-weight: bold; display: block; margin-bottom: 10px; }
        .post-body { font-size: 19px; line-height: 1.6; color: #333; text-align: justify; }

        /* FORMULÁRIO DE REDAÇÃO */
        .form-box { max-width: 600px; margin: 0 auto; padding: 30px; background: #fff; border: 2px solid var(--dark-blue); }
        input, textarea { 
            width: 100%; padding: 15px; margin-bottom: 15px; border: 1px solid var(--mystic-blue);
            font-size: 16px; box-sizing: border-box; background: #fafafa;
        }
        
        .upload-area { 
            display: block; border: 2px dashed var(--gold); padding: 25px; 
            text-align: center; margin-bottom: 20px; cursor: pointer; color: var(--mystic-blue);
        }

        .btn-postar { 
            background: var(--dark-blue); 
            color: var(--gold); border: 2px solid var(--gold); width: 100%; padding: 20px; 
            cursor: pointer; font-weight: bold; font-size: 18px; text-transform: uppercase;
        }

        .btn-del { position: absolute; top: 10px; right: 10px; background: transparent; border: none; color: #ccc; cursor: pointer; font-size: 20px; }
        .btn-del:hover { color: red; }
    </style>
</head>
<body>

    <div id="capa">
        <img src="foto.png" class="logo-capa" alt="ENIGMA FALLS">
        <div class="welcome-text">Informativo Oficial do Servidor</div>
        <div class="botoes">
            <button class="btn" onclick="mudarTela('tela-visualizar'); carregar();">Ver Notícias</button>
            <button class="btn" onclick="abrirRedacao()">Painel de Controle</button>
        </div>
    </div>

    <div id="tela-visualizar" class="tela">
        <div class="nav-interna">
            <img src="foto.png" style="height: 60px; border-radius: 50%;">
            <button onclick="mudarTela('capa')" class="btn" style="padding: 10px 20px; font-size: 12px; background: var(--dark-blue);">VOLTAR</button>
        </div>
        <div id="feed" class="feed"></div>
    </div>

    <div id="tela-gerar" class="tela">
        <div class="nav-interna"><h2>NOVA PUBLICAÇÃO</h2> <button onclick="mudarTela('capa')" style="cursor:pointer; font-weight:bold;">FECHAR</button></div>
        <div class="form-box">
            <input type="text" id="tit" placeholder="TÍTULO DA MANCHETE">
            <input type="text" id="art" placeholder="PESSOAS CITADAS">
            <textarea id="fat" rows="6" placeholder="O QUE ACONTECEU NO SERVIDOR?"></textarea>
            
            <label class="upload-area">
                <strong>✨ SELECIONAR FOTO DA MATÉRIA ✨</strong>
                <input type="file" id="input-foto" accept="image/*" style="display: none;" onchange="previewImagem(this)">
                <div id="preview-msg" style="font-size: 14px; margin-top: 10px; color: green; display: none; font-weight: bold;">FOTO CARREGADA COM SUCESSO!</div>
            </label>

            <button class="btn-postar" id="btn-publicar" onclick="publicar()">PUBLICAR AGORA</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBtQZwmY-PG9SVlFueM0o2n4Mj0ebVQwTY",
            authDomain: "portal-enigma-falls.firebaseapp.com",
            projectId: "portal-enigma-falls",
            databaseURL: "https://portal-enigma-falls-default-rtdb.firebaseio.com",
            storageBucket: "portal-enigma-falls.firebasestorage.app"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const SENHA = "777";
        let imagemBase64 = "";

        function mudarTela(id) {
            document.querySelectorAll('.tela, #capa').forEach(t => t.style.display = 'none');
            document.getElementById(id).style.display = (id === 'capa') ? 'flex' : 'block';
        }

        function abrirRedacao() {
            if(prompt("SENHA DE REDATOR:") === SENHA) mudarTela('tela-gerar');
        }

        function previewImagem(input) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagemBase64 = e.target.result;
                document.getElementById('preview-msg').style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
        }

        function publicar() {
            const t = document.getElementById('tit').value;
            const a = document.getElementById('art').value;
            const f = document.getElementById('fat').value;
            const btn = document.getElementById('btn-publicar');

            if(!t || !f) return alert("Erro: Manchete e Fatos são obrigatórios.");

            btn.disabled = true;
            btn.innerText = "ENVIANDO AO PORTAL...";

            let base = `O Portal Enigma Falls apurou novos detalhes envolvendo ${a}. Segundo informações de nossos correspondentes: ${f}. `;
            let complemento = "Nossa equipe continuará monitorando os eventos e trará novas informações assim que os fatos se desenrolarem no servidor. Fique atento para mais atualizações oficiais.";
            let textoFinal = base + (f.length < 90 ? complemento : "");

            db.ref('noticias').push({
                titulo: t, texto: textoFinal, imagem: imagemBase64, data: new Date().toLocaleString('pt-BR')
            }).then(() => {
                imagemBase64 = "";
                document.getElementById('tit').value = "";
                document.getElementById('fat').value = "";
                document.getElementById('preview-msg').style.display = 'none';
                btn.disabled = false;
                btn.innerText = "PUBLICAR AGORA";
                mudarTela('tela-visualizar');
                carregar();
            });
        }

        function apagar(id) {
            if(prompt("SENHA PARA EXCLUIR:") === SENHA) db.ref('noticias/' + id).remove();
        }

        function carregar() {
            db.ref('noticias').on('value', snapshot => {
                const feed = document.getElementById('feed');
                feed.innerHTML = "";
                let lista = [];
                snapshot.forEach(d => { let n = d.val(); n.id = d.key; lista.unshift(n); });
                
                feed.innerHTML = lista.map(n => `
                    <div class="post">
                        <button class="btn-del" onclick="apagar('${n.id}')">✕</button>
                        <span class="post-meta">BOLETIM ENIGMA • ${n.data}</span>
                        <h2>${n.titulo}</h2>
                        ${n.imagem ? `<img src="${n.imagem}">` : ''}
                        <div class="post-body">${n.texto}</div>
                    </div>
                `).join('');
            });
        }
    </script>
</body>
</html>
